<!DOCTYPE html>
<html>
<head>
<title>내 맘대로</title>
<meta charset="UTF-8">
<script   src="http://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>
</head>
<body>
  <div id="container">
    <canvas
      id="drawCanvas" width="700" height="600" style=" border: 1px solid #000;"></canvas>
  </div>

  <script type="text/javascript">
    //window가 load 될때 Event Listener를 등록 하여 준다.
    window.addEventListener('load', InitEvent, false);

    var canvas, context, tool;
    var fixX, fixY, mouseX, mouseY;

    function InitEvent (){

      // Canvas 객체를 탐색 한다.
      canvas = document.getElementById('drawCanvas');
      if (!canvas) {
        alert('캔버스 객체를 찾을 수 없음');
        return;
      }

      if (!canvas.getContext) {
        alert(' Drawing Contextf를 찾을 수 없음');
        return;
      }

      // 2D canvas context를 가져 온다.
      context = canvas.getContext('2d');
      if (!context) {
        alert('getContext() 함수를 호출 할 수 없음');
        return;
      }

      // tool_pencil 함수의 인스턴스를 생성 한다.
      tool = new tool_pencil();

      // Canvas에 mousedown, mousemove, mouseup 이벤트 리스너를 추가한다.
      canvas.addEventListener('mousedown', ev_canvas, false);
      canvas.addEventListener('mousemove', ev_canvas, false);
    }

    // 마우스 이동을 추적 하여 그리기 작업을 수행 한다.
    function tool_pencil (){

        var tool = this;
        this.started = false;
        this.mdFlag = false;

        // 마우스를 누를때 그리기 작업을 시작 한다.
        this.mousedown = function (ev){
          //처음 눌림
          if(!tool.mdFlag){
            fixX = ev._x;
            fixY = ev._y;

            tool.mdFlag = true;
          }
          else{

          }
        };

        // 마우스가 이동 할때(mousemove) 마다 호출 된다.
        this.mousemove = function (ev){
          mouseX = ev._x;
          mouseY = ev._y;

          //클릭 된 상태
          if (tool.mdFlag){
            reset();
          }
        };

    }


    // Canvas요소 내의 좌표를 결정 한다.
    function ev_canvas (ev){

        if (ev.layerX || ev.layerX == 0){
          // Firefox 브라우저
          ev._x = ev.layerX;
          ev._y = ev.layerY;
        }
        else if (ev.offsetX || ev.offsetX == 0){
          // Opera 브라우저
          ev._x = ev.offsetX;
          ev._y = ev.offsetY;
        }

        // tool의 이벤트 핸들러를 호출한다.
        var func = tool[ev.type];

        if (func)
        {
            func(ev);
        }
    }

    function reset (){
      context.clearRect(0,0,canvas.width, canvas.height);
      this.drawLine(fixX,fixY,mouseX,mouseY );
    }

    function drawLine(startX, startY, endX, endY){
      console.log('draw');

      context.beginPath();
      context.moveTo(startX, startY);
      context.lineTo(endX, endY);
      context.lineWidth = 5;
      context.strokeStyle = '#393969';
      context.stroke();
    }


    </script>

</body>
</html>
